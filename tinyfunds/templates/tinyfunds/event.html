<!doctype html>
{% extends 'base.html' %}
{# Load the tag library #}
{% load bootstrap4 %}
{% load static %}

{# Load CSS and JavaScript #}
{% bootstrap_css %}
{% bootstrap_javascript jquery='full' %}
<!-- {% load socialaccount %}
{% load static %} -->

{# Display django.contrib.messages as Bootstrap alerts #}
{% bootstrap_messages %}

{# Display a form #}
{% block navbar %}
<ul class="navbar-nav mr-auto justify-content-center">
  <li class="nav-item">
    <a class="nav-link" href="{% url 'home' %}"><strong>Home</strong></a>
  </li>
  <li class="nav-item active">
    <a class="nav-link active" href="{% url 'explore' %}"><strong>Explore</strong></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="#"><strong>Post</strong></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{% url 'account' %}"><strong>Account</strong></a>
  </li>
</ul>
{% endblock navbar %}
{% block content %}


<link rel="stylesheet" href="{% static 'vendor/bootstrap/css/bootstrap.css' %}">
<link rel="stylesheet" href="{% static 'account/style.css' %}">

<div class="container-fluid">
  <div class="row">
    <div class="col-sm-1">
    </div>
    <div class="col-sm-3">
      <br>
      <h4>{{ event.title }}</h4>
      <br>
      <div class="pfpic"><img src="{{ event.pic }}"></div>
      <br>
    </div>
    <div class="col-sm-4">
      <br>
      <h4>Event Description</h4>
      <p>
        {{ event.description }}
      </p>
      <br><br>
      <h4>Info</h4>
      <p> 
        Organizer: {{event.org_name }} 
        <br>
        Date: {{event.event_date}}
        <br>
        Location: {{event.address}}
        <br>
      </p>
        {% if user.id %}
        <!-- <a href="{% url 'donate_event' event.id user.id %}">Donate to {{ event.title }}!</a> -->
        {% endif %}
        {% ifequal event.owner_id user.id %}
        <button class=btn" onclick="toggleEdit()">Edit Event</button>
        <br><br>
        <script>
            function toggleEdit() {
                var x = document.getElementById("editEvent");
                if (x.style.display === "none") {
                    x.style.display = "inline-flex";
                } else {
                    x.style.display = "none";
                }
            }
        </script>
        <div id="editEvent" style='display: none'>
          <div class="row">
            <br>
            <form action="{% url 'edit_event' event.id %}" method="post">
              {% csrf_token %}
              <input type="text" name="title" id="title" placeholder="Event Title..."><br><br>
              <input type="text" name="org_name" id="org_name" placeholder="Organization Name..."><br><br>
              <input type="text" name="event_date" id="event_date" placeholder="MM/DD/YYYY"><br><br>
              <input type="text" name="address" id="address" placeholder="Enter the address here..."><br><br>
              <input type="text" name="pic" id="pic" placeholder="Enter your image url here..."><br><br>
            <input type="number" name="goal" id="goal" min="0" step=".01" placeholder="Enter goal here..."><br><br>
              <textarea type="text" rows="4" cols="30" name="description" id="description"
                  placeholder="Enter event description here..."></textarea><br>
              <input type="submit" class="btn" value="Post">
            </form>
          </div>
          <p>
        </div>
        {% endifequal %}
        <p>
            <h2> Goal: ${{event.money_goal}} </h2>
            <br>
            <h2> Received: ${{event.money_received}} </h2>
            {% if event.surplus %}
            <h3> Goal surpassed! </h3>
            {% elif event.met %}
            <h3> Goal met! </h3>
            {% endif %}
            <br>
            <h2> Hours committed: {{event.hours_received}}</h2>
            <br>
        </p>
    </div>
    <div class="col-sm-2">
        <br>
        {% if user.id %}
        <script>
            function togglePledge(type) {
                var hours = document.getElementById("pledge_hours");
                var money = document.getElementById("pledge_money");
                if (type == 'hours') {
                    money.style.display = "none";
                    var pledges = document.getElementById("pledges");
                    if (hours.style.display === "none") {
                        hours.style.display = "block";
                        pledges.style.height = "calc(100vh - 500px)";
                    } else {
                        hours.style.display = "none";
                        pledges.style.height = "calc(100vh - 295px)";
                    }
                } else {
                    hours.style.display = "none";
                    var pledges = document.getElementById("pledges");
                    if (money.style.display === "none") {
                        money.style.display = "block";
                        pledges.style.height = "calc(100vh - 500px)";
                    } else {
                        money.style.display = "none";
                        pledges.style.height = "calc(100vh - 295px)";
                    }
                }
            }
        </script>
        <button onclick="togglePledge('money')">Pledge a donation!</button>
        <br><br>
        <button onclick="togglePledge('hours')">Pledge hours!</button>
        <br><br>
      <form action="{% url 'pledge_hours' event.id %}" method="post" id="pledge_hours" style="display:none">
        {% csrf_token %}
        <input type="hidden" name="user_id" value="{{ user.id }}">
        <input type="number" required name="amount" id="amount" min="0" step=".01" placeholder="Amount" style="width: 150px;"><br><br>
        <textarea type="text" rows="4" cols="20" name="text" id="description"
            placeholder="Enter pledge text..."></textarea><br>
          <input type="submit" class="btn" value="Pledge!">
          <br>
        </form>
      <form action="{% url 'pledge' event.id %}" method="post" id="pledge_money" style="display:none;">
        {% csrf_token %}
        <input type="hidden" name="user_id" value="{{ user.id }}">
        <input type="number" required name="amount" id="amount" min="0" step=".01" placeholder="Number of hours..." style="width: 150px;"><br><br>
        <textarea type="text" rows="4" cols="20" name="text" id="description"
            placeholder="Enter pledge text..."></textarea><br>
          <input type="submit" class="btn" value="Pledge!">
          <br>
        </form>
        <a href="{% url 'checkout' event.pk  %}" type="button" class="btn btn-light-blue btn-md" >Donate</a>
        {% endif %}
        <ul id="pledges" class="list-group list-group-flush" style="margin-top:12px; height: calc(100vh - 295px); overflow-y: auto;">
            {% for pledge in event.ordered_pledges %}
            <li class="list-group-item"> 
                {% if pledge.confirmed %}
                <h1 style="color: green"> 
                {% else %}
                <h1> 
                {% endif %}
                {% if pledge.payment_amount %}
                    ${{ pledge.payment_amount }} </h1>
                {% else %}
                    {{ pledge.hours_amount }} hr</h1>
                {% endif %}
                <br>
                {{ pledge.payment_text }}
                <br><br>
                <a href="{% url 'user' pledge.payer_id %}">Pledger</a>
                {% ifequal event.owner_id user.id %}
                {% if not pledge.confirmed %}
                <form action="{% url 'confirm' event.id %}" method="post">
                  {% csrf_token %}
                  <input type="hidden" name="p_id" value="{{ pledge.id }}">
                  <input type="hidden" name="u_id" value="{{ pledge.payer_id }}">
                  <input type="submit" class="btn" value="Confirm">
                </form>
                {% endif %}
                {% endifequal %}
            </li>
            <br>
            {%endfor%}
        </ul>
    </div>
    <div class="col-sm-1">
    </div>
  </div>
</div>
{% endblock content %}
